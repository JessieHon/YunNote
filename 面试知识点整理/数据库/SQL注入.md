# SQL注入

###### SQL注入是恶意用户通过在表单中填写包含SQL关键字的数据来使数据库执行非常规代码的过程。

###### 如何防止SQL注入？

- 在构建数据库上时尽量使用较为复杂的结构和命名方式将会极大地减少被成功攻击的概率

- 使用正则表达式等字符串过滤手段限制数据项的格式、字符数目。理论上，只要避免数据项中存在引号、分好等特殊字符就能很大程度上避免SQL注入的发生。

- 使用预编译语句可以完全防止SQL注入，#代替$

  - 一条SQL在db接收到最终执行完毕返回可以分成三个过程：词法和语义解析、优化SQL语句，制定执行计划、执行并返回结果
  - 但是很多情况下，一条SQL语句可能会反复执行，或者每次执行只有个别的值不同
  - 所谓预编译语句就是将这类语句中的值用占位符替代，可以视为将sql语句模板化或者说参数化。
  - 预编译语句的优势在于：一次编译、多次运行，省去了解析优化的时间；防止sql注入

  ###### 为什么预编译语句可以防止SQL注入

  原理是采用了预编译的方法，先将SQL语句中可被客户端控制的参数集进行编译，生成对应的临时变量集，再使用对应的设置方法，为临时变量集里面的元素进行赋值，赋值函数setString()，会对传入的参数进行强制类型检查和安全检查，所以就避免了SQL注入的产生。

  ###### mybatis中#和$的区别，是怎么防止SQL注入的？

  #将传入的数据都当成一个字符串，会对自动传入的数据加一个双引号

  $将传入的数据直接显示在SQL中

  mybatis的SQL是一个具有输入+输出的功能，类似于函数的结构，其中parameterType表示了输入的参数类型，resultType表示了输出的参数类型

  mybatis启用了预编译功能，在SQL执行前，会将SQL发送给数据库进行编译，执行时，直接使用编译好的SQL，替换占位符？。

  因为SQL注入只能对编译过程起作用，所以这样的方式就很好的避免了SQL注入的问题。

  ###### mybatis预编译底层实现

  在框架底层，是JDBC中的preparedStatement类在起作用，它的对象包含了编译好的SQL语句，这种“准备好”的方式不仅能提高安全性，并且能在多次执行同一个SQL时，能够提高效率。原因是SQL已经编译好，再次执行时无需编译。