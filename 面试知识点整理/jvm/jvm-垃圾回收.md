# jvm-垃圾回收

- G1收集器和cms收集器的区别
  - CMS收集器是concurrent mark  sweep
    - 分成四个阶段
      - 初始标记
      - 并发标记
      - 重新标记
      - 并发清除
  - G1收集器是Garbage  first收集器
    - 首先是思想上的一个改变，在G1收集器之前所有的收集器，包括CMS在内，垃圾收集的目标范围要么是整个新生代，要么是整个老年代，要么就是整个java堆
    - G1可以面向堆内存任何部分组成回收集进行回收，衡量标准不再是属于哪个分代，而是哪个内存的存放的垃圾数量最多，回收收益最大
    - 实现原理：将连续的java堆划分成多个大小相等的独立区域，每个region可以根据需要，扮演新生代中的eden，survior或者老年代空间，收集器能够对扮演不同角色的region采取不同的策略
    - 更具体的思路是：让G1收集器去跟踪每个region里面的垃圾堆积的价值大小，价值即回收收获得空间大小和回收所需要的时间，然后在后台维护一个优先级列表，每次根据用户设定的允许收集停顿时间（-XX：MAXGCPauseMills）优先处理回收价值收益最大的那些region
    - 步骤：
      - 初始标记
      - 并发标记
      - 最终标记
      - 筛选回收
    - 优点：
      - 并行与并发，多核环境下的硬件优势
      - 分代收集。能够采用不同的方式去处理已经存活了一段时间的对象，不需要与其他收集器进行合作。
      - 空间整合。G1从整体上来看基于“标记-整理”算法实现的收集器，从局部上看是基于复制算法实现的，因此G1运行期间不会产生空间碎片。
      - 可预测的停顿。G1能建立可预测的时间停顿模型，能让使用者明确指定一个长度为M毫秒的时间片段内，消耗在垃圾收集上的时间不得超过N毫秒。
    -  -XX:+UseG1GC 使用 G1 收集器，jdk9 默认使用 G1 收集器
