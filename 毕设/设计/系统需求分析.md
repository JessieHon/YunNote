## 驾校综合信息管理系统--贾江红

#### 大纲：

系统分为web管理端和小程序两部分，web端主要用于实现管理员对驾校学员、员工、车辆、预约、考试安排、缴费的管理功能、练车情况，学员情况和收费情况的统计功能。

 微信小程序端主要供学员使用，学员可以通过小程序进行缴费、预约练车、考试预约申请、意见反馈等操作。



#### 功能：（原因、需求内容、实现）

##### 信息管理

- 学员信息管理
  - 具体信息：id,姓名，身份证号，性别，地址，学车类别（C1/A2/...）,是否毕业
  - 具体需求：
    - 用户可以通过微信小程序   录入/查看/修改  自己的个人信息
    - 管理员通过web端可以  查询/删除/修改   用户的个人信息
- 员工信息管理
  - 具体信息：id，姓名，身份证号，性别，地址
  - 具体需求：
    - 管理员通过web端可以  增加/查询/删除/修改   员工的个人信息
- 车辆信息管理
  - 具体信息：id、编号、车辆状态（正常、维修、停用）、用途（科目二/科目三）
  - 具体需求：
    - 管理员通过web端 录入/更改/删除/查询  车辆信息
- 缴费管理
  - 功能背景：
    - 方便驾校统计收支
    - 为学员提供缴费凭证，避免纠纷
  - 具体需求：
    - 驾校可以定义各种服务项和对应的价格
    - 学员可以通过微信小程序付费。
  - 具体信息：id，服务项，费用
  - 具体实现：
    - web端定义各种服务项，生成收费套餐，包括各种服务项以及总额。
    - 学员通过小程序，根据需要选择套餐，进行付款
    - 付款完成后，学员正式进入驾考流程。
- 意见反馈管理
  - 具体信息：id，学员id，意见内容
  - 功能背景：提高教学质量，增强学员与驾校之间的联系
  - 具体需求：学员可以通过小程序反馈这段时间的学车心得或者建议

##### 考试预约

- 考试预约申请

  - 功能背景：

    - 考试预约必须通过交管网站由考生本人预约，驾校无法代为预约。
    - 法律规定，学员必须在通过科目一考试的十天之后才可以进行科目二考试预约，必须在通过科目一考试的30天之后才可以进行科目三考试预约，每次考试不及格后，必须十天后才能再次预约本科目考试。
    - 学员考试未通过产生的补考费用由驾校承担，所以为了保证及格率，学员进行考试预约需要驾校同意。
    - 学员考试预约成功后，需要驾校组织车辆一起去考试，所以需要由驾校安排该日考试的人数，应该尽可能安排每次人数合理。
    - 交管网发布的考试安排中，每日考试人数有限，学员预约考试后，预约结果根据交管网当日考试预约考生的上一次考试时间进行排名，考试时间靠前的考生排名高于考试时间靠后的考生，排名超过安排的考试人数之后，预约将会失败，所以可以通过本系统根据学员上次考试时间进行预排名，推测预约结果，辅助驾校决策每个批次的考试人数和考试学员。

  - 具体信息：id，学员id，申请科目、申请日期、是否同意、是否预约成功、考试信息id

  - 具体需求：

    - 学员达到法律规定的条件可以进行某科目预约时，应该通过微信小程序给学员发送提醒
    - 学员可以取消预约

  - 具体实现：

    - 提醒格式：

      - 推送 1：xxx您好，xxx驾校提醒您！您已达到法律规定的科目xx考试预约条件，请您尽快联系教练对您该科目练习水平进行评估 ，评估完成后，通过本程序发送考试预约申请。
      - 推送 2 ：xxx您好，xxx驾校提醒您！您已达到法律规定的科目二考试预约条件，如果您希望科目二科目三一起预约，请您再耐心等待xx天，达到科目三预约条件后，通过本程序发送科目二和科目三考试预约申请，期间请您联系教练，听从练车安排。

    - 提醒实现：服务端设置定时任务，定时对没有拿证的学员按照法律规定的时间条件遍历，对满足条件的学员推送提醒。

      - 伪代码：for（学员 i : 全部没拿证的&&七天内没有发送过提醒的 学员{

        ​						if(i.当前已完成科目 == 0){            //0代表还没进行科目一考试

        ​								推送提醒（微信id,1， i.姓名，1);//用户id，推送格式，姓名，科目x

        ​						}else if(i.当前已完成科目 == 1&&10 < now - i.get科目一通过时间() < 30&&i.get上一次考试时间() > 10){

        ​								推送提醒（微信id, 1，i.姓名, 2);

        ​								推送提醒（微信id, 2，i.姓名, 30-(now - i.get上次考试时间()));

        ​						}else if(i.当前已完成科目 == 2&&now - i.get科目一通过时间() < 30 && &&i.get上一次考试时间() > 10){

        ​								推送提醒（微信id, 1，i.姓名, 3);

        ​						}else if(i.当前已完成科目 == 3){

        ​								推送提醒（微信id, 1，i.姓名, 4);

        ​						}

        ​			   }

##### 考试安排

- 考试安排
  - 功能背景：同考试预约申请背景        ：论文上需要再写一遍吗？
  - 具体信息：
    - id，科目几，考试日期，考试地址，学员id，是否考试通过
    - 消息格式：您的科目xx预约申请，已通过，请您通过交管12123按照以下信息进行考试预约。考试时间：xxxx年xx月xx日，考场：xxxx考场。如果有疑问，请咨询xx教练。预约结果出来后，尽快通过本程序反馈预约结果，感谢配合。
  - 具体需求：
    - 根据同批次的学员申请预约信息，本系统根据学员的上一次考试时间进行排序显示，将预约成功率最高的学员显示在最上面。
    - 驾校同意预约后，推送消息给学员。
    - 学员收到交管12123发送的预约结果后，通过小程序反馈预约结果。
    - 驾校可以看到某一天考试的学员明细

##### 练车预约

- 练车预约

  - 功能背景：

    - 练车高发季，驾校车辆以及教练有限
    - 减少学员等待时间，提高学车效率
    - 疫情期间，减少人员聚集
    - 市面的练车预约系统没有权限功能，每位学员公平竞争每辆车的练车机会，公平的同时可能会导致快考试的学员预约不上练车，所以引入权限机制，科目二预约成功之后，该学员会自动解锁考试车辆，增加可以预约的车辆，增大预约成功几率。

  - 具体信息：

    - id，车辆id，时段，是否生效

  - 具体需求：

    - 驾校通过web端制定练车时段、每个学员的单次预约最大练车时长、每个时段学员同时练车最大数量，生效时间、失效时间，是否生效，生效车辆。
    - 学员通过微信小程序选择时段和练车时长进行预约，已经预约考试成功的学员会比其他学员增加考试车辆的选择，教练也可以通过平台根据学员练车水平解锁某个车辆。
    - 学员可以在练车开始前随时取消预约。
    - 预约时显示每个车辆的预约情况（是否已经预约满，每个时段已经预约的人数/可预约的总人数）

  - 具体实现：

    - 维护一张  学员-车辆  表，存储每个学员可以练习的车辆，科目二考试预约成功时，自动解锁全部车辆，教练也可以为某个学员解锁某个车辆。
    - 驾校通过web端制定练车时段、每个学员的单次预约最大练车时长、每个时段学员同时练车最大数量，生效时间、失效时间，是否生效，生效车辆，是否排序。

    - 学员在微信小程序端选择车辆、时段预约练车

##### 统计

- 缴费统计
  - 功能背景：方便驾校管理者统计收支，了解价格趋势
  - 具体需求：驾校可以看到每个月/年/周的统计情况（订单金额，订单数量，变化趋势等）
  - 具体实现：根据订单表的信息，按照周/月/年维度统计结果显示给驾校
- 练车情况统计
  - 功能：统计学员的平均练车时长，便于驾校了解练车情况，提高教学质量。
  - 具体实现：根据每个人的练车预约表，统计出平均练车时长
- 学员情况统计
  - 功能：方便驾校针对某个学员，观察其练车进度，做出相应的安排。
  - 具体实现：根据练车预约表，得出某个学员的练车情况。

- web端权限

  - 功能背景：为了保证信息安全，不同用户的权限不同。

  - 具体需求：

    - | 角色   | web端权限                                                    |
      | ------ | ------------------------------------------------------------ |
      | 管理员 | 全部（学员管理、员工管理、车辆管理、缴费管理、考试预约、考试安排、练车预约、缴费统计、练车统计、学员情况统计） |
      | 员工   | 学员管理、车辆管理、考试预约、考试安排、练车预约、练车统计、学员情况统计 |
      | 学员   | 无                                                           |

  - 具体实现：基于RBAC（基于角色控制权限）

##### 其他

- 日志
  - 功能背景：
    - 保证数据安全，宕机后迅速恢复
    - 系统崩溃后可以快速找到原因并恢复
  - 具体信息：谁（who） 在  哪个时间（when）  做了 哪些操作（what）
  - 具体需求：
    - 数据库表中记录数据的creater和createtime、updater和updateTime
    - 生成日志文件持久化到硬盘，包括谁调用了哪个时间调用了哪个接口

#### 数据要求：

- 数据删除要求
  - 具体需求：每个数据都有意义，慎重删除，要求所有的删除都是逻辑删除。
  - 具体实现：设置删除字段，删除只是将该条数据置成无效。



#### 安全控制：

- 数据安全性保证措施：
  - 用户登录时需要输入账号密码
  - 增加日志，记录用户操作
  - 数据库本身安全级别：可重复读
  - 一些重要操作写成事务，在异常情况时可以快速回滚，不至于产生脏数据
- 系统安全性：
  - 当前市面上流行的服务器提供安全性保证
  - 软件开发方面使用springSecurity框架，对用户权限做校验
- 并发安全
  - 当前系统的练车预约功能模块涉及到并发安全，可能会有多个用户同时预约同一时段的同一车辆，通过锁机制保证并发安全。

#### 后期功能扩展

- 增加缓存：
  - 背景：
    - 用户量增多，查询变慢时，通过增加缓存提高查询速度。
- 增加驾校区别标识
  - 背景
    - 业务由一个驾校扩展到多个驾校时