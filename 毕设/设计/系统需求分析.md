#### 大纲：

系统分为web管理端和小程序两部分，web端主要用于实现管理员对驾校学员、员工、车辆、预约、考试安排、缴费的管理功能、练车情况，学员情况和收费情况的统计功能。

 微信小程序端主要供学员使用，学员可以通过小程序进行缴费、预约练车、考试预约申请、查看驾考进度，练车排队、驾考在线学习、意见反馈等操作。



#### 功能：（原因、需求内容、实现）

##### 信息管理

- 学员信息管理
  - 具体信息：状态
  - 具体需求：
    - 用户可以通过微信小程序   录入/查看/修改  自己的个人信息
    - 管理员通过web端可以  查询/删除/修改   用户的个人信息
  - 数据库表设计：
- 员工信息管理
  - 具体信息：
  - 具体需求：
    - 管理员通过web端可以  增加/查询/删除/修改   员工的个人信息
  - 数据库表设计：
- 车辆信息管理
  - 具体信息：编号、车辆状态、用途
  - 具体需求：
    - 管理员通过web端 录入/更改/删除/查询  车辆信息
- 缴费管理
  - 功能背景：
    - 方便驾校统计收支
    - 为学员提供缴费凭证，避免纠纷
  - 具体需求：
    - 驾校可以定义各种服务项和对应的价格
    - 学员可以通过微信小程序付费。
  - 具体信息：各种收费项，收费总额，
  - 具体实现：
    - web端定义各种服务项，生成收费套餐，包括各种服务项以及总额。
    - 学员通过小程序，根据需要选择套餐，进行付款
    - 付款完成后，学员正式进入驾考流程。

##### 预约申请和考试安排

- 考试预约申请

  - 功能背景：

    - 考试预约必须通过交管网站由考生本人预约，驾校无法代为预约。
    - 法律规定，学员必须在通过科目一考试的十天之后才可以进行科目二考试预约，必须在通过科目一考试的30天之后才可以进行科目三考试预约，每次考试不及格后，必须十天后才能再次预约本科目考试。
    - 学员考试未通过产生的补考费用由驾校承担，所以为了保证及格率，学员进行考试预约需要驾校同意。
    - 学员考试预约成功后，需要驾校组织车辆一起去考试，所以需要由驾校安排该日考试的人数，应该尽可能安排每次人数合理。
    - 交管网发布的考试安排中，每日考试人数有限，学员预约考试后，预约结果根据交管网当日考试预约考生的上一次考试时间进行排名，考试时间靠前的考生排名高于考试时间靠后的考生，排名超过安排的考试人数之后，预约将会失败，所以可以通过本系统根据学员上次考试时间进行预排名，推测预约结果，辅助驾校决策每个批次的考试人数和考试学员。

  - 具体信息：

  - 具体需求：

    - 学员达到法律规定的条件可以进行某科目预约时，应该通过微信小程序给学员发送提醒

  - 具体实现：

    - 提醒格式：

      - 推送 1：xxx您好，xxx驾校提醒您！您已达到法律规定的科目xx考试预约条件，请您尽快联系教练对您该科目练习水平进行评估 ，评估完成后，通过本程序发送考试预约申请。
      - 推送 2 ：xxx您好，xxx驾校提醒您！您已达到法律规定的科目二考试预约条件，如果您希望科目二科目三一起预约，请您再耐心等待xx天，达到科目三预约条件后，通过本程序发送科目二和科目三考试预约申请，期间请您联系教练，听从练车安排。

    - 提醒实现：服务端设置定时任务，定时对没有拿证的学员按照法律规定的时间条件遍历，对满足条件的学员推送提醒。

      - 伪代码：for（学员 i : 全部没拿证的&&七天内没有发送过提醒的 学员{

        ​						if(i.当前已完成科目 == 0){            //0代表还没进行科目一考试

        ​								推送提醒（微信id,1， i.姓名，1);//用户id，推送格式，姓名，科目x

        ​						}else if(i.当前已完成科目 == 1&&10 < now - i.get科目一通过时间() < 30&&i.get上一次考试时间() > 10){

        ​								推送提醒（微信id, 1，i.姓名, 2);

        ​								推送提醒（微信id, 2，i.姓名, 30-(now - i.get上次考试时间()));

        ​						}else if(i.当前已完成科目 == 2&&now - i.get科目一通过时间() < 30 && &&i.get上一次考试时间() > 10){

        ​								推送提醒（微信id, 1，i.姓名, 3);

        ​						}else if(i.当前已完成科目 == 3){

        ​								推送提醒（微信id, 1，i.姓名, 4);

        ​						}

        ​			   }

- 考试安排

  - 功能背景：同考试预约申请背景        ：论文上需要再写一遍吗？
  - 具体信息：
    - 消息格式：您的科目xx预约申请，已通过，请您通过交管12123按照以下信息进行考试预约。考试时间：xxxx年xx月xx日，考场：xxxx考场。如果有疑问，请咨询xx教练。预约结果出来后，尽快通过本程序反馈预约结果，感谢配合。
  - 具体需求：
    - 根据同批次的学员申请预约信息，本系统根据学员的上一次考试时间进行排序显示，将预约成功率最高的学员显示在最上面。
    - 驾校同意预约后，推送消息给学员。
    - 学员收到交管12123发送的预约结果后，通过小程序反馈预约结果。

##### 练车预约功能

- 练车预约

  - 功能背景：

    - 练车高发季，驾校车辆以及教练有限
    - 减少学员等待时间，提高学车效率
    - 已经预约成功的学员应该在考试前获得更多的练车机会（两种方案的取舍）
      - 已有的系统是定时开始预约，没有优先级排序
    - 疫情期间，减少人员聚集

  - 具体需求：

    - 驾校通过web端制定练车时段、每个学员的单次预约最大练车时长、每个时段学员同时练车最大数量，生效时间、失效时间，是否生效。
    - 学员通过微信小程序选择时段和练车时长进行预约。
    - 当预约数量太多时，按照学员状态优先级(priority)决定学员（考试已经预约成功-3>已经预约考试还没结果-2>还没预约考试-1）是否可以预约上练车时段，状态相同时，按照考试时间/提交申请时间先后进行排序。
    - 学员可以在练车开始前随时取消预约。

  - 具体实现：

    - 驾校通过web端制定练车时段、每个学员的单次预约最大练车时长、每个时段学员同时练车最大数量，生效时间、失效时间，是否生效。

    - 学员在微信小程序端根据发布的预约时段，选择时段进行练车预约。

    - 当日预约立即出预约结果，明日预约下午六点出结果。

    - 具体算法：

      - 学员 compareTo(学员1，学员2){

        if(学员1.priority != 学员2.priority)

        ​		if(学员1.priority > 学员2.priority)

        ​				return 学员1

        ​			}

        ​		else if(学员1.priority < 学员2.priority){

        ​				return 学员2

        ​			}

        }else if(学员1.priority=3){                                          //都已经预约成功

        ​		if（学员1.考试时间 早于 学员2的考试时间）{

        ​				return 学员1

        ​		}else if(学员1.考试时间 晚于 学员2的考试时间){

        ​				return 学员2

        ​		}else if(学员1.申请时间  早于  学员2.申请时间){

        ​				return 学员1

        ​		}else{

        ​				return 学员2

        ​		}

        }else if(学员1.上次考试时间 != 学员2.上次考试时间){

        ​		if(学员1.上次考试时间 早于 学员2.上次考试时间){

        ​					return 学员1

        ​		}else{

        ​					return 学员2

        ​		}		

        }else if(学员1.申请时间  早于  学员2.申请时间){

        ​				return 学员1

        ​		}else{

        ​				return 学员2

        ​		}

        }

##### 统计功能

- 缴费统计
  - 功能背景：方便驾校管理者统计收支，了解价格趋势
  - 具体需求：驾校可以看到每个月/年/周的统计情况（订单金额，订单数量，变化趋势等）
  - 具体实现：根据订单表的信息，按照周/月/年维度统计结果显示给驾校
- 练车情况统计
  - 功能：统计学员的平均练车时长，按照每一考试项进行统计，便于驾校针对某一考试项优化教学质量。
- 学员情况统计
  - 功能：方便驾校针对某个学员，观察其练车进度，做出相应的安排。

- web端权限

  - 功能背景：为了保证信息安全，不同用户的权限不同。

  - 具体需求：

    - | 角色   | web端权限 |
      | ------ | --------- |
      | 管理员 | 全部      |
      | 员工   |           |
      | 学员   | 无        |

  - 具体实现：基于RBAC（基于角色控制权限）

- 日志
  - 功能背景：
    - 保证数据安全，宕机后迅速恢复
    - 系统崩溃后可以快速找到原因并恢复
  - 具体信息：谁（who） 在  哪个时间（when）  做了 哪些操作（what）
  - 具体需求：
    - 数据库表中记录数据的creater和createtime、updater和updateTime
    - 生成日志文件持久化到硬盘，包括谁调用了哪个时间调用了哪个接口

#### 数据要求：

- 数据删除要求
  - 具体内容：逻辑删除
- 记录日志
  - 具体内容：记录数据内容更改的时间和人





#### 安全控制：

- 数据安全
  - 日志
  - 数据本身安全级别：可重复读
  - 一些重要数据写成事务，在系统宕机时可以快速回滚，不至于产生脏数据
- 系统安全
- 并发安全



#### 后期功能扩展

- 增加缓冲：
  - 背景：
    - 用户量增多，查询变慢
- 增加驾校区别标识
  - 背景
    - 多个驾校使用同一套系统